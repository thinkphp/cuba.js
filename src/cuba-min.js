/*
 * cuba.js: a micro-framework JavaScript
 * copyright Adrian Statescu 2013 (@thinphp)
 * http://thinkphp.ro
 * MIT License
 */
var cuba={version:"@VERSION@",name:"cuba.js",select:function(a){this.value=Array.prototype.slice.call(document.querySelectorAll(a));return this},one:function(a){a=a.replace("#","");this.value=[document.getElementById(a)];return this},grab:function(a){a=a.replace("#","");return document.getElementById(a)},getAll:function(a){return document.querySelectorAll(a)},getOne:function(a){return document.querySelectorAll(a)[0]},first:function(a){if(typeof a=="undefined"){this.value=this.value.length>0?[this.value[0]]:[]}else{return this.value.length>0?this.value[0]:null}return this},last:function(a){if(typeof a=="undefined"){this.value=this.value.length>0?[this.value[this.value.length-1]]:[]}else{return this.value.length>0?this.value[this.value.length-1]:null}return this},is:function(a){return a&&a.nodeName&&a.nodeType==1},each:function(b,d){var a=b.length,c;for(c=0;c<a;c++){d.call(this,b[c],c,b)}return b},some:function(a,e,d){for(var c=0,b=a.length;c<b;c++){if(e.call(d,a[c],c,a)){return true}}return false},getStyle:document.defaultView&&document.defaultView.getComputedStyle?function(b,d){var c=null;if(d=="float"){d="cssFloat"}var a=document.defaultView.getComputedStyle(b,"");c=a[cuba.lang.camelize(d)];return b.style[d]||c}:(ie&&html.currentStyle)?function(a,c){c=cuba.lang.camelize(c);c=c=="float"?"styleFloat":c;if(c=="opacity"){var f=100;try{f=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{f=a.filters("alpha").opacity}catch(d){}}}var b=a.currentStyle?a.currentStyle[c]:null;return a.style[c]||b}:function(a,b){return a.style[cuba.lang.camelize[b]]},css:function(a){this.value=this.each.call(this,this.value,function(b){b.style.cssText=a});return this},attr:function(b,c){this.value=this.each.call(this,this.value,function(a){a.setAttribute(b,c)});return this},removeAttr:function(a){this.value=this.each.call(this,this.value,function(b){b.removeAttribute(a)});return this},html:function(a,c){var b=/select|fieldset|table|tbody|tfoot|td|tr|colgroup/i,d=c?document.documentElement===null?"innerText":"innerHTML":"innerHTML";typeof a!=="undefined"?this.each.call(this,this.value,function(e){e[d]=a}):this.each.call(this,this.value,function(e){e[d]=a});return this},addClass:function(a,b){if("classList" in document.createElement("p")){arguments.length==1&&typeof a=="string"?this.value=this.each.call(this,this.value,function(c){c.classList.add(a)}):a.classList.add(b)}else{this.value=this.each.call(this,this.value,function(c){c.className=cuba.lang.trim(c.className+" "+b)})}return this},hasClass:function(a,b){if("classList" in document.createElement("p")){return a.classList.contains(b)}else{return this.classReg(b).test(a.className)}},removeClass:function(a,b){if("classList" in document.createElement("p")){arguments.length==1&&typeof a=="string"?this.value=this.each.call(this,this.value,function(c){c.classList.remove(a)}):a.classList.remove(b)}else{this.value=this.each.call(this,this.value,function(c){c.className=cuba.lang.trim(c.className+" "+b)})}return this},classReg:function(a){return new RegExp("(^|\\s+)"+a+"(\\s+$)")},toggleClass:function(a){this.each.call(this,this.value,function(b){this.hasClass(b,a)?this.removeClass(b,a):this.addClass(b,a)})},on:function(c,b,a){this.value=this.each.call(this,this.value,function(e){if(e.addEventListener){return e.addEventListener(c,b,a)}else{if(e.attachEvent){var f=function(){b.call(e,window.event)};var d=e.attachEvent("on"+c,f);e[b.toString()+c]=f;return d}else{e["on"+c]=b}}});return this},unbind:function(c,b,a){this.value=this.each.call(this,this.value,function(d){if(d.addEventListener){return d.removeEventListener(c,b,a)}else{if(d.detachEvent){return d.detachEvent("on"+c,d[b.toString()+c]);d[b.toString()+c]=null}else{d["on"+c]=function(){}}}});return this},attach:function(e,d,b,a){if(e.addEventListener){return e.addEventListener(d,b,a)}else{if(e.attachEvent){var f=function(){b.call(e,window.event)};var c=e.attachEvent("on"+d,f);e[b.toString()+d]=f;return c}else{e["on"+d]=b}}},detach:function(d,c,b,a){if(d.addEventListener){return d.removeEventListener(c,b,a)}else{if(d.detachEvent){return d.detachEvent("on"+c,d[b.toString()+c]);d[b.toString()+c]=null}else{d["on"+c]=function(){}}}},stopPropagation:function(a){if(window.event){window.event.cancelBubble=true;window.event.returnValue=false}if(a.preventDefault&&a.stopPropagation){a.preventDefault();a.stopPropagation()}},getTarget:function(a){var b=window.event?window.event.srcElement:a?a.target:null;while(b.nodeType!=1&&b.nodeName.toLowerCase()!="body"){b=b.parentNode}if(!b){return false}return b},ajax:function(g,d,f,a){function c(h,i){h.onreadystatechange=function(){if(h.readyState==4){if(h.status==200){i(h.responseText)}}}}var e=function(){var h;try{h=new XMLHttpRequest();e=function(){return new XMLHttpRequest()}}catch(i){try{h=new ActiveXObject("Microsoft.XMLHTTP");e=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(i){}}return e()};var b=e();b.open(g,d,true);if(a){b.setRequestHeader("Content-type","application/x-www-form-urlencoded");b.setRequestHeader("Content-length",a.length);b.setRequestHeader("Connection","close")}c(b,f);b.send(a||null);return b},script:function(a,c){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);b.setAttribute("id","leach");if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete"){b.onreadystatechange=null;c(b);var d=document.getElementById("leach");if(d){d.parentNode.removeChild(d)}}}}else{b.onload=function(){c(b);var d=document.getElementById("leach");if(d){d.parentNode.removeChild(d)}}}document.getElementsByTagName("head")[0].appendChild(b)},loadLink:function(a){var c=document.head||document.getElementsByTagName("head")[0],b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);if(a){c.appendChild(b)}},ready:function(l){var q=[],m,j=false,k=document,b=k.documentElement,p=b.doScroll,a="DOMContentLoaded",c="addEventListener",h="attachEvent",i="detachEvent",g="readyState",o="onreadystatechange",e=/^loade|c/.test(k[g]);function n(){e=1;while(j=q.shift()){j()}}k[c]&&k[c](a,m=function(){k.removeEventListener(a,m,j);n()},j);p&&k.attachEvent(o,m=function(){if(/^c/.test(k[g])){k[i](o,m);n()}});(function(d){e?d():q.push(d)})(l)},yql:function(b,d,c,a){this.query=b;this.format=c||"json";this.diagnostics=a||false;this.fetch(d);return this},fetch:function(h){var b=document.createElement("script"),f="http://query.yahooapis.com/v1/public/yql?q=",a="&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",c=encodeURIComponent(this.query),d=this.format,g="YQL"+(+new Date()),e=f+c+"&format="+d+"&callback=cuba."+g+"&diagnostics="+this.diagnostics+a;cuba[g]=function(i){if(window.console){console.log(i)}h(i);delete cuba[g];document.body.removeChild(b)};b.setAttribute("type","text/javascript");b.setAttribute("src",e);document.body.appendChild(b);return this},jsonp:function(b,f,e,a){this.url=b;this.callback=f;this.jsonCallbackName=a||"callback";if(e!=="undefined"&&typeof e=="object"){var d="";for(var c in e){if(e.hasOwnProperty(c)){d+=encodeURIComponent(c)+"="+encodeURIComponent(e[c])+"&"}}this.url=this.url+"?"+d}this.url=this.url+"&"+this.jsonCallbackName+"=?";this.fetchjson(f);return this},fetchjson:function(f){var e=new Date().getTime(),d=document,c="callback_"+e,a=this.url.replace("=?","=cuba."+c),b=d.createElement("script");b.setAttribute("type","text/javascript");cuba[c]=this.evalJSON(f);b.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(b);this.s=b;this.fn=c},evalJSON:function(a){return function(c){var b=false;if(typeof c=="string"){b=JSON.parse(c)}else{if(typeof c=="object"){b=c}else{b=JSON.parse(JSON.stringify(c))}}if(b){a(b);if(window.console){console.log("VALID JSON")}}else{if(window.console){oonsole.log("JSONP call returned invalid JSON or empty JSON")}}}},canTransitions:(function(){var c=["transition","MozTransition","WebkitTransition","KhtmlTransition","OTransition","msTransition"],a=c.length,d=document.body||document.documentElement;for(var b=0;b<a;b++){if("string"==typeof d.style[c[b]]){return c[b]}}return false})(),fadeIn:function(a,b,c){b=b||2;this.runFade(a,b,0,100,c);return this},fadeOut:function(a,b,c){b=b||2;this.runFade(a,b,100,0,c);return this},fadeInById:function(c,a,b){a=a||2;this.runFade(document.getElementById(c),a,0,100,b);return this},fadeOutById:function(c,a,b){a=a||2;this.runFade(document.getElementById(c),a,100,0,b);return this},runFade:function(d,c,j,g,k){var k=k||function(){},i=function(f,l){f.style.filter="alpha(opacity="+l+")";f.style.opacity=l/100};if(cuba.canTransitions){d.style.opacity=(j==100)?1:0;d.style[cuba.canTransitions]="opacity "+c*1000+"ms linear";d.style.opacity=(g==100)?1:0;return}var e=j;var b;if(g>=j){b=2}else{b=-2}var a=(c*1000)/50;var h=window.setInterval(function(){if((e>=g&&b>0)||(e<=g&&b<0)){clearInterval(h)}i(d,e);e+=b},a);return this},animate:function(a){return move(a)}};HTMLElement.prototype.fadeOut=function(b,a){cuba.fadeOut(this,b)};HTMLElement.prototype.fadeIn=function(b,a){cuba.fadeIn(this,b)};cuba.badges={twitter:function(){},flickr:function(){},lastfm:function(){},weather:function(){}};HTMLElement.prototype.Click=function(a){return cuba.attach(this,"click",a,false)};(function(a){var d={top:"px",bottom:"px",left:"px",right:"px",width:"px",height:"px","margin-left":"px"};a.move=function(f){return typeof f=="object"?new e(f):new e(move.select(f))};move.select=function(f){return document.getElementById(f)||document.querySelectorAll(f)[0]};move.version="1.0.0";move.defaults={duration:500};move.ease={"in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",linear:"cubic-bezier(0.250, 0.250, 0.750, 0.750)","ease-in-quad":"cubic-bezier(0.550, 0.085, 0.680, 0.530)","ease-in-cubic":"cubic-bezier(0.550, 0.055, 0.675, 0.190)","ease-in-quart":"cubic-bezier(0.895, 0.030, 0.685, 0.220)","ease-in-quint":"cubic-bezier(0.755, 0.050, 0.855, 0.060)","ease-in-sine":"cubic-bezier(0.470, 0.000, 0.745, 0.715)","ease-in-expo":"cubic-bezier(0.950, 0.050, 0.795, 0.035)","ease-in-circ":"cubic-bezier(0.600, 0.040, 0.980, 0.335)","ease-in-back":"cubic-bezier(0.600, -0.280, 0.735, 0.045)","ease-out-quad":"cubic-bezier(0.250, 0.460, 0.450, 0.940)","ease-out-cubic":"cubic-bezier(0.215, 0.610, 0.355, 1.000)","ease-out-quart":"cubic-bezier(0.165, 0.840, 0.440, 1.000)","ease-out-quint":"cubic-bezier(0.230, 1.000, 0.320, 1.000)","ease-out-sine":"cubic-bezier(0.390, 0.575, 0.565, 1.000)","ease-out-expo":"cubic-bezier(0.190, 1.000, 0.220, 1.000)","ease-out-circ":"cubic-bezier(0.075, 0.820, 0.165, 1.000)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.320, 1.275)","ease-out-quad":"cubic-bezier(0.455, 0.030, 0.515, 0.955)","ease-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1.000)","ease-in-out-quart":"cubic-bezier(0.770, 0.000, 0.175, 1.000)","ease-in-out-quint":"cubic-bezier(0.860, 0.000, 0.070, 1.000)","ease-in-out-sine":"cubic-bezier(0.445, 0.050, 0.550, 0.950)","ease-in-out-expo":"cubic-bezier(1.000, 0.000, 0.000, 1.000)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.150, 0.860)","ease-in-out-back":"cubic-bezier(0.680, -0.550, 0.265, 1.550)"};var c=window.getComputedStyle||window.currentStyle;function b(){this.callbacks={}}b.prototype.on=function(g,f){(this.callbacks[g]=this.callbacks[g]||[]).push(f);return this};b.prototype.emit=function(k){var g=Array.prototype.slice.call(arguments,1),j=this.callbacks[k],f;if(j){f=j.length;for(var h=0;h<f;++h){j[h].apply(this,g)}}return this};a.Move=function e(f){if(window.console){console.log(f)}if(!(this instanceof e)){return new e(f)}b.call(this);this.el=f;this._props={};this._transitionProps=[];this._transforms=[];this._rotate=0;this.duration(move.defaults.duration)};e.prototype=new b;e.prototype.constructor=e;e.prototype.setProperty=function(g,f){this._props[g]=f;return this};e.prototype.setVendorProperty=function(g,f){this.setProperty("-webkit-"+g,f);this.setProperty("-moz-"+g,f);this.setProperty("-ms-"+g,f);this.setProperty("-o-"+g,f);return this};e.prototype.set=function(g,f){this.transition(g);if(typeof f=="number"&&d[g]){f+=d[g]}this._props[g]=f;return this};e.prototype.transition=function(f){this._transitionProps.push(f)};e.prototype.applyProperties=function(){var f=this._props,g=this.el;for(var h in f){if(f.hasOwnProperty(h)){g.style.setProperty(h,f[h],"")}}return this};e.prototype.then=function(f){if(f instanceof e){this.on("end",function(){f.end()})}else{if(typeof f=="function"){this.on("end",f)}else{var g=new e(this.el);g._transforms=this._transforms.slice(0);this.then(g);g.parent=this;return g}}return this};e.prototype.end=function(g){var f=this;if(this._transforms.length){this.setVendorProperty("transform",this._transforms.join(" "))}this.setVendorProperty("transition-properties",this._transitionProps.join(", "));this.applyProperties();if(g){this.then(g)}window.setTimeout(function(){f.emit("end")},this._duration);return this};e.prototype.duration=function(f){f=this._duration="string"==typeof f?parseFloat(f)*1000:f;return this.setVendorProperty("transition-duration",f+"ms")};e.prototype.pop=function(){return this.parent};e.prototype.delay=function(f){f="string"==typeof f?parseFloat(f)*1000:f;return this.setVendorProperty("transition-delay",f+"ms")};e.prototype.ease=function(f){f=move.ease[f]||f||"ease";return this.setVendorProperty("transition-timing-function",f)};e.prototype.transform=function(f){this._transforms.push(f);return this};e.prototype.translate=e.prototype.to=function(f,g){g=g||0;return this.transform("translate("+f+"px, "+g+"px)")};e.prototype.translateX=e.prototype.x=function(f){return this.transform("translateX("+f+"px)")};e.prototype.translateY=e.prototype.y=function(f){return this.transform("translateY("+f+"px)")};e.prototype.rotate=function(f){return this.transform("rotate("+f+"deg)")};e.prototype.scale=function(f,g){g=null==g?f:g;return this.transform("scale("+f+", "+g+")")};e.prototype.scaleX=function(f){return this.transform("scale("+f+")")};e.prototype.scaleY=function(f){return this.transform("scale("+f+")")};e.prototype.skew=function(f,g){g=g||0;return this.transform("skew("+f+"deg, "+g+"deg)")};e.prototype.skewX=function(f){return this.transform("skewX("+f+"deg)")};e.prototype.skewY=function(f){return this.transform("skewY("+f+"deg)")}})(this);cuba.lang=cuba.lang||{};(function(){var a=cuba.lang,c=Object.prototype,g={"&":"&amp","<":"&lt",">":"&gt",'"':"&quot","'":"&#x27","/":"&#x2F","`":"&#x60"},h="[object Array]",b="[object Function]",f="[object Object]",e=[],d={isArray:function(i){return c.toString.apply(i)==h},isBoolean:function(i){return typeof i==="boolean"},isFunction:function(i){return(typeof i==="function")||c.toString.apply(i)===b},isNull:function(i){return i===null},isNumber:function(i){return typeof i==="number"&&isFinite(i)},isObject:function(i){return(i&&(typeof i==="object")||a.isFunction(i))||false},isString:function(i){return typeof i==="string"},isUndefined:function(i){return typeof i==="undefined"},isValue:function(i){return a.isObject(i)||a.isString(i)||a.isNumber(i)||a.isBoolean(i)},escapeHTML:function(i){return i.replace(/[&<>"'\/`]/g,function(j){return g[j]})},trim:function(i){try{return String.prototype.trim?i.trim():i.replace(/(^\s*|\s*$)/g,"")}catch(j){return i}},camelize:function(i){try{return i.replace(/-(.)/g,function(k,l){return l.toUpperCase()})}catch(j){return i}},augmentObject:function(l,j){if(!l||!j){throw new Error("Failed, verify argumetns")}var k,i=arguments[2];for(k in j){if(i||!(k in j)){l[k]=j[k]}}return l},mixins:function(){var i,k,j={};for(i=0;i<arguments.length;i++){for(k in arguments[i]){j[k]=arguments[i][k]}}return j}};a.hasOwnProperty=(c.hasOwnProperty)?function(i,j){return i&&i.hasOwnProperty&&i.hasOwnProperty(j)}:function(i,j){return !a.isUndefined(i[j])&&i.constructor.prototype[j]!==i[j]};d.augmentObject(a,d,true);cuba.lang=a;cuba.extend=d.augmentObject;cuba.mixins=d.mixins})();cuba.UI=cuba.UI||{};(function(){var a=cuba.UI;var b={accordion:function(c,f,d){cuba.loadLink(d);var e=cuba.grab(c);cuba.attach(e,"click",function(g){var s=cuba.getTarget(g);if(cuba.hasClass(s.parentNode,f)){if(s.nodeName.toLowerCase()=="h1"){var q=[],l=[];var s=g.target,j=s.parentNode;var k=j.nextSibling;while(k&&(k.nodeType!=1||k.nodeType!=2)){k=k.nextSibling;q.push(k)}var h=j.previousSibling;while(h&&(h.nodeType!=1||h.nodeType!=2)){h=h.previousSibling;l.push(h)}var r=q.length,m=l.length;for(var o=0;o<r;o++){if(q[o]!=null&&q[o].nodeType==1){cuba.addClass(q[o],f)}}for(var o=0;o<m;o++){if(l[o]!=null&&l[o].nodeType==1){cuba.addClass(l[o],f)}}cuba.removeClass(j,f)}}})},autosuggest:function(){},tabview:function(){}};cuba.extend(a,b,true);cuba.UI=a})();(function(b,a){var c=function(e,d){return e.replace((RegExp("{([^{}]*)}","gi")),function(f,g){return d[g]})};b[a]=c})(cuba,"template");cuba.util=cuba.util||{};cuba.util.CustomEvent=function(){var a={};return{addEvent:function(b,c){if(typeof a[b]==="undefined"){a[b]=[]}a[b].push(c)},removeEvent:function(e,b){if(a[e] instanceof Array){var d=a[e],f=d.length,c;for(c=0;c<f;c++){if(d[c]==b){d.splice(c,1);break}}}},fireEvent:function(){var d=null;if(arguments[0]&&typeof arguments[0]==="string"){d={type:arguments[0],pass:arguments[1]}}if(typeof d==null){throw new Error("missing event")}var c=a[d.type],e=c.length,b;for(b=0;b<e;b++){c[b].call(this,d.pass||null)}}}}();cuba.util.cache=function(){var b=window.localStorage,a="cache.cuba.js # ";return{expiry:60*60*1000,set:function(e,f,d){this.expiry=d||this.expiry||100000;var g=new Date().getTime(),c=JSON.stringify({data:f,expiry:g});b.setItem(a+e,c);return[e,f]},get:function(d,f){var d=a+d,e=b.getItem(d);if(e){var c=JSON.parse(e);if((new Date().getTime())-c.expiry<this.expiry){return c.data}else{return false}}},remove:function(c){var c=a+c;b.removeItem(c);return c}}}();cuba.router=function(){var c=[],g=[];function a(i,h){c.push([i,h])}function b(){var h,l=c.length,k=[];for(h=0;h<l;h++){var j=c[h][0].replace(/:[^\/]+/gi,function(i){k.push(i.substring(1));return"([^/]+)"});g.push({keys:k,handler:c[h][1],re:new RegExp(j)})}}function d(){window.addEventListener("hashchange",function(){f(document.location.hash)})}function f(h){var q,k=g.length,p={};for(q=0;q<k;q++){var r=h.match(g[q].re);if(r){var t=g[q].keys,l=t.length;for(var o=0;o<l;o++){p[t[o]]=r[q+1]}var s=g[q].handler;if(s){s(p)}}}}function e(){d();b()}return{get:a,run:e}}();Function.prototype.binding=function(){var c=this,a=Array.prototype.slice.call(arguments),b=a.shift();return function(){return c.apply(b,a.concat(Array.prototype.slice.call(arguments)))}};
